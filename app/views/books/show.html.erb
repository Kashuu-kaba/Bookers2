<div class="container mt-4 ">
  <div class="row">

    <%= render "books/list", user:@user %>

    <div class="col-md-8 offset-md-1">
      <h2>Book detail</h2>
        <table class="table">
            <tbody>
              <tr>
                <td>
                  <%= link_to(user_path(@user.id)) do %>
                    <%= attachment_image_tag @user, :profile_image, format: "jpeg", fallback: "no_image.jpg", size: "40x40"%>
                    <br>
                    <%= @user.name %>
                  <% end %>
                  <br>
                </td>
                <td>
                  <%= link_to(book_path(@b.id)) do %>
                      <%= @b.title %>
                  <% end %>
                </td>
                <td>
                  <%= @b.body %>
                </td>
                <td>
                  <% if @b.favorited_by?(current_user) %>
                    <%= link_to book_favorites_path(@b), method: :delete do %>
                      <i class="fas fa-heart"></i><%= @b.favorites.count%>
                    <% end %>
                  <% else %>
                    <%= link_to book_favorites_path(@b), method: :post do %>
                      <i class="far fa-heart"></i><%= @b.favorites.count%>
                    <% end %>
                  <% end %>
                </td>
                <td>
                  <p>コメント数:<%= @b.book_comments.count %></p>
                </td>

              <% if @user.id == current_user.id %>
                <td><%= link_to "Edit", edit_book_path(@b.id), type:"button", class:"btn btn-success btn-sm" %></td>
                <td><%= link_to "Destroy", book_path(@b.id), method: :delete, type:"button", class:"btn btn-danger btn-sm", data: {confirm:"削除しますか？"}  %></td>
              <% end %>
              </tr>
            </tbody>
       </table>

       <table>
         <tbody>
             <% @b.book_comments.each do |book_comment| %>
           <tr>
             <td>

               <%= link_to user_path(book_comment.user.id) do %>
                    <%= attachment_image_tag book_comment.user, :profile_image, format: "jpeg", fallback: "no_image.jpg", size: "40x40"%>
                    <br>
                    <p><%= book_comment.user.name %></p>
               <% end %>
             </td>
             <td>
               <p><%= book_comment.comment %></p>
             </td>
             <td>
               <% if book_comment.user.id == current_user.id %>
                 <p><%= link_to "Destroy", book_book_comment_path(@b.id, book_comment.id), method: :delete,class:"btn btn-danger btn-sm" %></p>
               <% end%>
             </td>
           </tr>
             <% end %>
         </tbody>
       </table>

       <%= form_with(model: [@b, @book_comment], url: book_book_comments_path(@b.id, @book_comment.id),local:true) do |f| %>
         <div class="field pb-3">
           <%= f.label :comment %><br />
           <%= f.text_area :comment, autofocus: true, class:"col-12 form-control" %>
         </div>
         <div class="actions pb-3">
           <%= f.submit "送信", class:"btn btn-light btn-sm"%>
         </div>
       <% end %>
    </div>

  </div>
</div>